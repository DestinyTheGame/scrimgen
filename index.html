<!doctype html>
<html class="no-js" lang="en-US">
<head>
  <meta charset="utf-8">
  <title>Scrim map generator</title>
  <meta name="description" content="Generates map rotation for Destiny 2 scrims">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#fafafa">
  <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
  <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">
  <style>
    #advanced {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100vw;
      border-top: 1px solid #F1F1F1;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>
      The following maps are selected

      <button class="btn btn-link btn-action float-right" id="again">
        <i class="icon icon-refresh"></i>
      </button>
    </h2>
    <div id="target"></div>


    <details class="accordion" id="advanced">
      <summary class="accordion-header">
        <i class="icon icon-arrow-right mr-1"></i>
        <strong>Advanced Settings</strong>
      </summary>
      <form class="accordion-body" action="#">
        <div class="column col-6 col-xs-12">
          <div class="form-group">
            <label class="form-label" for="amount">How many maps</label>
            <input class="form-input" id="amount" type="number" value="3" min="1" max="4" name="amount">
          </div>

          <div class="divider text-center" data-content="Do you prefer small, medium or large maps"></div>

          <div class="form-group">
            <label class="form-switch tooltip" data-tooltip="E.g. Exodus, Burnout">
              <input type="checkbox" value="s" name="size" checked>
              <i class="form-icon"></i> Small
            </label>
          </div>

          <div class="form-group">
            <label class="form-switch tooltip" data-tooltip="E.g. Pasifica, Rusted Lands">
              <input type="checkbox" value="m" name="size" checked>
              <i class="form-icon"></i> Medium
            </label>
          </div>

          <div class="form-group">
            <label class="form-switch tooltip" data-tooltip="E.g. Fortress, Fragment">
              <input type="checkbox" value="l" name="size" checked>
              <i class="form-icon"></i> Large
            </label>
          </div>
        </div>
      </form>
    </details>
  </div>

  <noscript>This site requires JavaScript to be enabled in order to generate maps</noscript>

  <script>
    (function bootstrap(modes=[]) {
      const target = document.getElementById('target');

      /**
       * Returns a random number between the given `min` and `max` values. We
       * don't need crypto level randomness, we're generating a list of maps so
       * some bias in RNG is not going to matter.
       *
       * @param {Number} min The minimum value.
       * @param {Number} max The maximum value.
       * @returns {Number} The generated random number.
       * @public
       */
      function random(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min
      }

      //
      // Current selection of maps that are available in the game.
      //
      // - `name` Human readable name of the map.
      // - `size` indicates the physical size of map, in t-shirt size.
      // - `modes` List of modes this map can be used in.
      //
      const maps = [
        { name: 'Altar of Flame', size: 'm', modes: ['clash'] },
        { name: 'Anomaly', size: 's', modes: ['clash'] },
        { name: 'Bannerfall', size: 'm', modes: ['clash'] },
        { name: 'Burnout', size: 's', modes: ['clash'] },
        { name: 'Cauldron', size: 's', modes: ['clash'] },
        { name: 'Convergence', size: 'm', modes: ['clash'] },
        { name: 'Dead Cliffs', size: 's', modes: ['clash'] },
        { name: 'Endless Vale', size: 's', modes: ['clash'] },
        { name: 'Exodus Blue', size: 's', modes: ['clash'] },
        { name: 'Fortress', size: 'l', modes: ['clash'] },
        { name: 'Fragment', size: 'l', modes: ['clash'] },
        { name: 'Javelin-4', size: 's', modes: ['clash'] },
        { name: 'Midtown', size: 'l', modes: ['clash'] },
        { name: 'Pacifica', size: 'm', modes: ['clash'] },
        { name: 'Radiant Cliffs', size: 'l', modes: ['clash'] },
        { name: 'Rusted Lands', size: 'm', modes: ['clash'] },
        { name: 'Twilight Gap', size: 'm', modes: ['clash'] },
        { name: 'Widow\'s Court', size: 'l', modes: ['clash'] },
        { name: 'Wormhaven', size: 'm', modes: ['clash'] }
      ];

      /**
       * Render the current map selection based on the pre-defined filters.
       *
       * @private
       */
      function render() {
        const size = Array.from(document.querySelectorAll('input[name="size"]:checked')).map((elem) => elem.value);
        const amount = document.getElementById('amount').value;

        const available = maps.filter(function filter(map) {
          if (!size.includes(map.size)) return false;
          if (!modes.length) return true;

          return map.modes.some(function some(mode) {
            return modes.include(mode);
          });
        });

        const selection = [];
        for (let i = 0; i < amount; i++) {
          const index = random(0, available.length - 1);

          //
          // We're splicing the map array to ensure that no duplicate maps are
          // being pulled from our
          //
          selection.push(...available.splice(index, 1));
        }

        if (!selection.length) return target.innerHTML = `
          <div class="empty">
            <div class="empty-icon">
              <i class="icon icon-emoji"></i>
            </div>
            <p class="empty-title h5">Congratulations</p>
            <p class="empty-subtitle">You've succesfully selected no maps, you muppet</p>
          </div>
        `;

        target.innerHTML = '<ol>' + selection.map(function format(map) {
          return `<li><span class="chip">${map.name}</span></li>`;
        }).join('') + '</ol>';
      }

      //
      // We have a bunch of advanced settings for our power uses that want to
      // generate a custom map selection so we want to ensure that we update
      // our results when changes happen.
      //
      Array.from(document.getElementsByTagName('input')).forEach(function listen(elem) {
        elem.addEventListener('change', render);
      });

      document.getElementById('again').addEventListener('click', render);
      return render();
    }());
  </script>
</body>
</html>
